"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[504],{3504:(e,r,t)=>{t.d(r,{A5:()=>y});var a=t(1839),s=t(8101),l=t(6746),n=t(3640);let o=(0,a.c)("Command",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]),d=(0,a.c)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),i=(0,a.c)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),c=(0,a.c)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),m=({clarification:e,options:r,input_type:t,onAnswerChange:l,onDismiss:n})=>{let o=(0,s.useMemo)(()=>{switch(t){case"single_choice":return a.j.jsx(a.S,{label:e,options:r.map(e=>({label:e,value:e})),onChange:l});case"multiple_choice":return a.j.jsx(a.M,{label:e,options:r.map(e=>({label:e,value:e})),onChange:l});default:return a.j.jsx(a.T,{label:e,onChange:e=>l(e.target.value)})}},[]);return a.j.jsxs("div",{className:"relative",children:[n&&a.j.jsx("button",{onClick:n,className:"absolute -right-2 -top-2 p-1 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors",title:"Dismiss",children:a.j.jsx(a.X,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),o]})};function x({apiEndpoint:e,dbName:r,token:t,onReportGenerated:c,onClarified:x=()=>{},onUploadDataFiles:u=()=>{}}){let[g,h]=(0,s.useState)({useWebsearch:!0,uploadedPDFs:[],uploadedDataFiles:[]}),[j,p]=(0,s.useState)(!1),[b,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(""),[w,k]=(0,s.useState)(!1),N=(0,s.useRef)(""),S=(0,s.useRef)(null),C=(0,s.useRef)(null),D=(0,s.useRef)(null);(0,s.useEffect)(()=>{f(navigator.userAgent.toLowerCase().includes("mac"))},[]);let _=(0,s.useContext)(a.a),P=(0,s.useCallback)(async()=>{var a,s,l;try{p(!0),N.current="Submitting report for generation...";try{await (0,n.g)(e,t,C.current||r,y,(null==(a=S.current)?void 0:a.value)||g.userQuestion,(null==(s=g.clarifications)?void 0:s.filter(e=>e.answer&&e.is_answered))||[],g.useWebsearch)}catch{_.success("Report submitted for generation"),c({userQuestion:(null==(l=S.current)?void 0:l.value)||g.userQuestion,reportId:y,status:n.O.THINKING,newDbName:C.current})}h({useWebsearch:!0,uploadedPDFs:[]}),k(!1),N.current="",S.current.value=""}catch(e){_.error("Error generating report:",e)}finally{p(!1)}},[g,e,t,r,y,c,_]);(0,s.useEffect)(()=>{var e;u(null==g?void 0:g.uploadedDataFiles),null!=g&&g.uploadedDataFiles&&(null==(e=null==g?void 0:g.uploadedDataFiles)?void 0:e.length)!==0||(C.current=null,D.current=null)},[null==g?void 0:g.uploadedDataFiles]);let[F,E]=(0,s.useState)(!1),T=(0,s.useMemo)(()=>{var e,r,t;return null!=(e=null==g?void 0:g.uploadedDataFiles)&&e.length||null!=(r=null==g?void 0:g.uploadedPDFs)&&r.length?a.j.jsx("div",{className:"w-full",children:a.j.jsxs("div",{className:"flex flex-wrap gap-2",children:[null!=(t=null==g?void 0:g.uploadedDataFiles)&&t.length?a.j.jsxs("div",{className:"flex flex-row items-center gap-2 w-full text-xs text-blue-600 dark:text-blue-400",children:[a.j.jsx(a.I,{className:"w-4 min-w-4"}),a.j.jsx("span",{children:"A new database will be created using your uploaded csv/excel files"})]}):a.j.jsx(a.j.Fragment,{}),g.uploadedDataFiles.map((e,r)=>a.j.jsxs("div",{className:"flex items-center flex-wrap max-w-full overflow-hidden justify-between bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2 text-sm",children:[a.j.jsxs("div",{className:"flex items-center max-w-[85%]",children:[a.j.jsx(d,{className:"w-4 h-4 mr-2 flex-shrink-0 stroke-blue-500 dark:stroke-blue-400"}),a.j.jsx("span",{className:"truncate max-w-40",title:e.fileName,children:e.fileName})]}),a.j.jsxs("div",{className:"flex items-center",children:[a.j.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mx-2",children:(0,a.f)(e.size)}),a.j.jsx("button",{type:"button",onClick:e=>{var t;e.stopPropagation();let a=null==(t=g.uploadedDataFiles)?void 0:t.filter((e,t)=>t!==r);h(e=>({...e,uploadedDataFiles:a})),D.current=null,C.current=null},className:"cursor-pointer ml-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400",children:a.j.jsx(a.C,{className:"w-4 h-4"})})]})]},`${e.fileName}-${r}`)),g.uploadedPDFs.map((e,r)=>a.j.jsxs("div",{className:"flex items-center flex-wrap max-w-full overflow-hidden justify-between bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2 text-sm",children:[a.j.jsxs("div",{className:"flex items-center max-w-[85%]",children:[a.j.jsx(i,{className:"w-4 h-4 mr-2 flex-shrink-0 stroke-blue-500 dark:stroke-blue-400"}),a.j.jsx("span",{className:"truncate max-w-40",title:e.fileName,children:e.fileName})]}),a.j.jsxs("div",{className:"flex items-center",children:[a.j.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mx-2",children:(0,a.f)(e.size)}),a.j.jsx("button",{type:"button",onClick:e=>{var t;e.stopPropagation();let a=null==(t=g.uploadedPDFs)?void 0:t.filter((e,t)=>t!==r);h(e=>({...e,uploadedPDFs:a}))},className:"cursor-pointer ml-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400",children:a.j.jsx(a.C,{className:"w-4 h-4"})})]})]},`${e.fileName}-${r}`))]})}):null},[g]);return a.j.jsx("div",{className:"h-full overflow-auto py-4 px-1 lg:px-10",children:a.j.jsxs("div",{className:"flex flex-col items-start justify-center min-h-full m-auto gap-10",children:[a.j.jsxs("div",{className:"w-full",children:[a.j.jsx("div",{className:"text-lg dark:text-gray-200 font-light mb-4",children:"Add a spreadsheet or select a database, and start asking your questions!"}),a.j.jsx(l.D,{fileSelection:!1,onDragOver:e=>{e.preventDefault(),e.stopPropagation(),E(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),E(!1)},onDrop:async e=>{var r,t;e.preventDefault(),e.stopPropagation(),E(!1);let s=null==(t=null==(r=null==e?void 0:e.dataTransfer)?void 0:r.items)?void 0:t[0];if(!s||!s.kind||"file"!==s.kind)throw Error("Invalid file");if(!(0,a.i)(s.type,!0))throw Error("Only CSV, Excel or PDF files are accepted");let l=s.getAsFile(),n=await l.arrayBuffer();if(l.type.endsWith("pdf")){let e=[...g.uploadedPDFs,{buf:n,fileName:l.name,size:l.size,type:l.type,isCsv:!1,isPdf:!0}];h(r=>({...r,uploadedPDFs:e}))}else{let e=[...g.uploadedDataFiles,{buf:n,fileName:l.name,size:l.size,type:l.type,isPdf:!1,isCsv:!0}];h(r=>({...r,uploadedDataFiles:e}))}C.current=null,D.current=null},children:a.j.jsx(a.T,{prefix:T,ref:S,rootClassNames:"p-2 w-full h-full rounded-xl border dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 overflow-hidden",textAreaClassNames:"border-0 outline-0 ring-0 shadow-none focus:ring-0",suffix:a.j.jsxs("div",{className:"flex flex-col",children:[a.j.jsxs("div",{className:"dark:text-gray-400 border-b dark:border-gray-700 pb-2",children:["Press"," ",b?a.j.jsxs(a.j.Fragment,{children:[a.j.jsx(o,{className:"inline align-middle w-2.5"}),"+ Enter"]}):"Ctrl + Enter"," ","to start. Drop PDFs to add context to the report. Drop CSV or Excel files to analyse them."]}),a.j.jsx(l.T,{title:"Use web search to enhance report",onLabel:"",offLabel:"",defaultOn:g.useWebsearch,disabled:w||!!g.clarifications,onToggle:e=>{h(r=>({...r,useWebsearch:e}))},rootClassNames:"mt-2"})]}),disabled:j,placeholder:F?"Release to drop":"Type here or drop PDF, CSV or Excel file",autoResize:!0,defaultRows:1,textAreaHtmlProps:{style:{resize:"none"}},onKeyDown:async s=>{var l,o;if("Enter"===s.key&&(s.metaKey||s.ctrlKey)){let d=s.currentTarget.value;if(!d){_.error("Please enter a question");return}try{k(!0),p(!0),N.current="Analyzing database and thinking if I need to ask clarifying questions. This can take 15-20 seconds...",h(e=>({...e,userQuestion:d}));let s=[];if(console.log("Processing uploaded PDFs:",(null==(l=g.uploadedPDFs)?void 0:l.length)||0),g.uploadedPDFs&&g.uploadedPDFs.length>0){for(let e of(console.log("Found PDFs to process:",g.uploadedPDFs.map(e=>e.fileName)),g.uploadedPDFs))try{let r=e.fileName;console.log("Processing PDF:",r,"Size:",e.size),console.log("PDF buffer created, size:",e.buf.byteLength);let t=(0,a.b)(e.buf);console.log("PDF converted to base64, length:",t.length),s.push({file_name:r,base64_content:t}),console.log("PDF added to processing list")}catch(r){console.error("Error processing PDF:",r),_.error(`Error processing PDF: ${e.fileName}`)}console.log("Finished processing PDFs, total processed:",s.length)}else console.log("No PDFs to process");let i=[];if(console.log("Processing uploaded data files:",i.length),(null==(o=g.uploadedDataFiles)?void 0:o.length)===0)console.log("No data files to process");else{for(let e of(console.log("Found data files to process:",g.uploadedDataFiles.map(e=>e.fileName)),g.uploadedDataFiles))try{let r=e.fileName;console.log("Processing data file:",r,"Size:",e.size),console.log("data file buffer created, size:",e.buf.byteLength);let t=(0,a.b)(e.buf);console.log("data file converted to base64, length:",t.length),i.push({file_name:r,base64_content:t}),console.log("data file added to processing list")}catch(r){console.error("Error processing data file:",r),_.error(`Error processing data file: ${e.fileName}`)}console.log("Finished processing PDFs, total processed:",i.length)}let c=await (0,n.a)(e,t,r,d,s,i);console.log("clarifications",c.clarifications),v(c.report_id),h(e=>({...e,clarifications:c.clarifications})),c.new_db_name&&c.new_db_info&&(C.current=c.new_db_name,D.current=c.new_db_info,x(C.current))}catch(e){console.log(e),_.error(e,1e4),k(!1)}finally{p(!1)}}}})})]}),!j&&g.clarifications&&a.j.jsxs("div",{className:"my-4 max-w-2xl",children:[a.j.jsx("div",{className:"font-light mb-2 dark:text-gray-300",children:"Add Details"}),a.j.jsxs("div",{className:"space-y-6",children:[a.j.jsx("div",{className:"space-y-2",children:g.clarifications.map((e,r)=>(0,s.createElement)(m,{...e,key:r+e.clarification,onAnswerChange:e=>{h(t=>({...t,clarifications:t.clarifications.map((t,a)=>a===r?{...t,answer:e,is_answered:!!e&&("string"==typeof e?!!e:e.length>0)}:t)}))},onDismiss:()=>{h(e=>({...e,clarifications:e.clarifications.filter((e,t)=>t!==r)}))}}))}),a.j.jsx(a.B,{className:"bg-gray-600 text-white border-0 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600",onClick:P,children:j?N.current:"Generate"})]})]}),j&&a.j.jsxs("div",{className:"w-full text-sm text-gray-400 dark:text-gray-500 relative flex items-start rounded-xl",children:[a.j.jsx(a.d,{}),N.current]})]})})}let u=({apiEndpoint:e,token:r,onDbCreated:t=(...e)=>{}})=>{let l=(0,s.useContext)(a.a),[n,o]=(0,s.useState)(!1);return a.j.jsxs("div",{className:"min-w-full min-h-full",children:[a.j.jsx(a.D,{disabled:n,rootClassNames:(0,a.t)(n?"hidden":""),acceptedFileTypes:Object.values(a.F),showIcon:!0,onFileSelect:async s=>{o(!0),s.preventDefault(),s.stopPropagation();try{let n=s.target.files[0];if(!n||!(0,a.i)(n.type))throw Error("Only CSV or Excel files are accepted");let d=await n.arrayBuffer();if("text/csv"===n.type)try{let{dbName:s}=await (0,a.u)(e,r,n.name,(0,a.b)(d)).catch(e=>{throw e});l.success(`DB ${s} created successfully`),t(s)}catch(e){throw o(!1),e}else try{let{dbName:s}=await (0,a.u)(e,r,n.name,(0,a.b)(d)).catch(e=>{throw e});l.success(`DB ${s} created successfully`),t(s)}catch(e){throw o(!1),e}}catch(e){console.error(e),l.error("Failed to parse the file")}},onDrop:async s=>{var n,d;o(!0),s.preventDefault(),s.stopPropagation();try{let i=null==(d=null==(n=null==s?void 0:s.dataTransfer)?void 0:n.items)?void 0:d[0];if(!i||!i.kind||"file"!==i.kind)throw Error("Invalid file");if(!(0,a.i)(i.type))throw Error("Only CSV or Excel files are accepted");let c=i.getAsFile(),m=performance.now(),x=await c.arrayBuffer();if("text/csv"===c.type)try{let{dbName:s}=await (0,a.u)(e,r,c.name,(0,a.b)(x)).catch(e=>{throw e}),n=performance.now();console.log(`CSV upload took ${n-m}ms`),l.success(`DB ${s} created successfully`),t(s)}catch(e){throw o(!1),e}else try{let{dbName:s}=await (0,a.u)(e,r,c.name,(0,a.b)(x));l.success(`DB ${s} created successfully`),t(s)}catch(e){throw o(!1),e}}catch(e){l.error(e.message||"Failed to parse the file"),console.log(e.stack)}}}),n&&a.j.jsxs("div",{className:"text-xs flex w-full h-full items-center justify-center gap-1",children:[a.j.jsx(a.d,{})," Uploading your file"]})]})};function g({step:e}){var r;let{function_name:t,result:s}=e;s||(s={});let{question:l,sql:o,columns:d=[],rows:i="[]",error:c="",df_truncated:m=!1}=s,x=c||(d&&d.length?"":"No results"),u=[];if(i&&!c)try{u=JSON.parse(i)}catch(e){console.error("Failed to parse rows JSON:",e),x="Failed to parse rows JSON"}let g=u.length;return a.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-full overflow-y-auto",children:[a.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary flex items-center",children:[a.j.jsx("span",{className:"mr-2",children:"SQL Query"}),!x&&a.j.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900/30 dark:text-blue-300",children:["Resulting data has ",g," ",1===g?"row":"rows"]})]}),l&&a.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[a.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),a.j.jsx("p",{className:"bg-gray-50 dark:bg-dark-bg-tertiary p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic",children:l})]}),(null==(r=e.inputs)?void 0:r.db_name)&&a.j.jsx("div",{className:"mb-3",children:a.j.jsxs("span",{className:"inline-flex items-center gap-1 bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300 text-xs font-medium px-2.5 py-1 rounded",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[a.j.jsx("path",{d:"M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"}),a.j.jsx("path",{d:"M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"}),a.j.jsx("path",{d:"M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"})]}),e.inputs.db_name]})}),x?a.j.jsxs("div",{className:"text-red-600 bg-red-100 p-3 rounded-md dark:bg-red-900/20 dark:text-red-400 dark:border dark:border-red-800",children:[a.j.jsxs("div",{className:"flex items-center mb-1",children:[a.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1.5",viewBox:"0 0 20 20",fill:"currentColor",children:a.j.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),a.j.jsx("strong",{children:"Query Error"})]}),a.j.jsx("p",{children:x})]}):a.j.jsx("div",{className:"mt-3 border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:a.j.jsx(a.e,{tabs:[{name:"Results",content:a.j.jsxs("div",{className:"relative p-3",children:[m&&a.j.jsxs("div",{className:"text-sm bg-yellow-50 p-2 rounded mb-3 border border-yellow-200 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800 flex items-center",children:[a.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5",viewBox:"0 0 20 20",fill:"currentColor",children:a.j.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Results have been truncated"]}),a.j.jsx(a.g,{columns:d.map(e=>({dataIndex:e,title:e})),rows:u,rootClassNames:"shadow-sm"})]})},{name:"SQL",content:a.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 p-3",children:a.j.jsx(n.C,{code:o||"",language:"sql",editable:!1})})}],defaultSelected:"Results"})})]})}function h({step:e}){let{function_name:r,result:t,inputs:s}=e,l=(0,n.s)(n.m.parse(t.answer),{allowedTags:n.s.defaults.allowedTags.concat(["img"]),allowedAttributes:{...n.s.defaults.allowedAttributes,img:["src","alt","title"]}});return a.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-[600px] overflow-y-auto",children:[a.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary",children:["Function: ",a.j.jsx("span",{className:"font-normal",children:r})]}),(null==s?void 0:s.question)&&a.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[a.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),a.j.jsx("p",{className:"bg-gray-50 dark:bg-dark-bg-tertiary p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic",children:s.question})]}),a.j.jsx("div",{className:"text-gray-700 dark:text-dark-text-secondary prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:l}}),t.reference_sources&&a.j.jsxs("div",{children:[a.j.jsx("h3",{children:"Reference Sources"}),a.j.jsx("ul",{children:t.reference_sources.map((e,r)=>a.j.jsx("li",{children:a.j.jsx("a",{href:e.url,target:"_blank",children:e.source})},r))})]})]})}function j({step:e}){let{function_name:r,result:t,inputs:s}=e,l=t.map(e=>e.text).join(""),o=(0,n.s)(n.m.parse(l),{allowedTags:n.s.defaults.allowedTags.concat(["img"]),allowedAttributes:{...n.s.defaults.allowedAttributes,img:["src","alt","title"]}});return a.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-[600px] overflow-y-auto",children:[a.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary",children:["Function: ",a.j.jsx("span",{className:"font-normal",children:r})]}),(null==s?void 0:s.question)&&a.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[a.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),a.j.jsx("p",{className:"bg-gray-50 dark:bg-dark-bg-tertiary p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic",children:s.question})]}),a.j.jsx("div",{className:"text-gray-700 dark:text-dark-text-secondary prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:o}})]})}let p=`

------

`;function b({apiEndpoint:e,token:r,reportId:t,onStreamClosed:l=()=>{},onDelete:n=()=>{}}){let[o,d]=(0,s.useState)([]),[i,c]=(0,s.useState)(!1),m=(0,s.useRef)(o);m.current=o;let x=(0,s.useContext)(a.a);return(0,s.useEffect)(()=>{let a=!1,s=new AbortController,n=(e,r=!1)=>{s.abort(),null==e||e.releaseLock(),c(!0),l(m.current,r)};return async function(){var l;try{let a=await fetch(`${e}/oracle/get_report_thinking_status?report_id=${t}`,{headers:{"X-Auth-Token":r},signal:s.signal});if(!a.ok){console.error("Stream request failed:",a.status),c(!0);return}let o=null==(l=a.body)?void 0:l.getReader();if(!o){console.error("No reader found on response body."),c(!0);return}let i=new TextDecoder("utf-8"),m="";for(;;){let{done:e,value:r}=await o.read();if(e){console.log("Stream ended from server.");break}let t=[];for(let e of(m+=i.decode(r,{stream:!0})).split(p)){let r=e.replace("data:","").trim();if(r){if("Stream closed without errors"===r){console.log("[Stream Event] 'Stream closed' received."),n(o);return}if("Stream closed with errors"===r){n(o,!0);return}try{let e=JSON.parse(r);if(e.error){x.error("Could not generate report. Error: "+e.error),n(o,!0);return}Array.isArray(e)?t.push(...e):t.push(e)}catch(e){console.warn("Failed to parse SSE data:",e)}}}d(t)}c(!0)}catch(e){a||console.error("[Stream Error]",e),c(!0)}}(),()=>{a=!0,s.abort()}},[e,r,t]),a.j.jsxs("div",{className:"relative p-2",children:[a.j.jsxs("div",{className:"flex flex-row w-full items-center mb-4 mt-4",children:[a.j.jsx("h1",{className:"text-xl font-bold grow dark:text-dark-text-primary",children:"Details"}),a.j.jsx(a.B,{variant:"danger",className:"self-end",onClick:n,children:"Delete"})]}),!i&&a.j.jsxs("div",{className:"w-full h-40 bg-white dark:bg-gray-800 rounded-md border flex items-center justify-center gap-2",children:[a.j.jsx(a.d,{classNames:"w-5 h-5 text-blue-500 animate-spin"}),a.j.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Creating SQL queries and searching the web to answer your question. I will show my thinking below. The report will automatically load when I am done thinking."})]}),a.j.jsx("div",{className:"w-full",children:o.filter(e=>{var r;return!("object"==typeof e.result&&null!=(r=e.result)&&r.error)}).reverse().map(e=>a.j.jsx("div",{className:"w-full md:w-1/2 p-2 inline-block align-top transition-all duration-500 ease-in-out",children:"text_to_sql_tool"===e.function_name?a.j.jsx(g,{step:e}):"web_search_tool"===e.function_name?a.j.jsx(h,{step:e}):"pdf_citations_tool"===e.function_name?a.j.jsx(j,{step:e}):null},e.id))})]})}let f=(e,r,t)=>{if(!e||!r||!t||!t[e])return"Today";for(let a of Object.keys(t[e]))if(t[e][a]&&Array.isArray(t[e][a])&&t[e][a].some(e=>String(e.report_id)===String(r)))return a;return"Today"};function y({apiEndpoint:e,token:r,initialDbNames:t=[]}){let[l,o]=(0,s.useState)(t),[d,i]=(0,s.useState)("Default DB"),[c,m]=(0,s.useState)({}),[g,h]=(0,s.useState)(!0),[j,p]=(0,s.useState)(null),[y,w]=(0,s.useState)(null),k=(0,s.useMemo)(()=>{if(!y||!c[d])return null;let e=f(d,y,c);return c[d][e]?c[d][e].find(e=>String(e.report_id)===String(y)):null},[y,c,d]),N=(0,s.useRef)((0,a.h)()),{current:S}=(0,s.useRef)(crypto.randomUUID().toString()),[C,D]=(0,s.useState)(!1),_=(0,s.useCallback)(e=>{if("u">typeof window){let r=new URL(window.location.href);if(null!==e){let t=String(e);r.searchParams.set("report_id",t)}else r.searchParams.delete("report_id");window.history.pushState({},"",r.toString())}},[]),P=(0,s.useRef)(!1),F=(0,s.useRef)(function(){if("u">typeof window){let e=new URLSearchParams(window.location.search).get("report_id");if(e){let r=Number(e);return isNaN(r)?e:r.toString()}}return null}());(0,s.useEffect)(()=>{!async function(){try{let t=F.current,a={},s=!1,o=null;l.length&&"Default DB"===d&&!t&&i(l.length?l[0]:S);let c=new Date,x=new Date(c);x.setDate(x.getDate()-1);let u=new Date(c);u.setDate(u.getDate()-7);let g=new Date(c);for(let d of(g.setMonth(g.getMonth()-1),l)){a[d]={Today:[],Yesterday:[],"Past week":[],"Past month":[],Earlier:[]};try{let l=await (0,n.f)(e,r,d);if(!l)throw Error("Failed to get reports");t&&!s&&(l.map(e=>e.report_id),l.find(e=>String(e.report_id)===String(t))&&(s=!0,o=d)),l.filter(e=>e.status!==n.O.ERRORED&&e.status!==n.O.INITIALIZED).forEach(e=>{let r=new Date(e.date_created+"Z"),t=new Date,s=new Date(t);s.setDate(s.getDate()-1);let l=new Date(t);l.setDate(l.getDate()-7);let n=new Date(t);n.setMonth(n.getMonth()-1),r.toDateString()===t.toDateString()?a[d].Today.push(e):r.toDateString()===s.toDateString()?a[d].Yesterday.push(e):r>=l?a[d]["Past week"].push(e):r>=n?a[d]["Past month"].push(e):a[d].Earlier.push(e)}),Object.entries(a[d]).forEach(([e,r])=>{r.sort((e,r)=>new Date(r.date_created+"Z").getTime()-new Date(e.date_created+"Z").getTime())})}catch{p("Failed to fetch reports for db name "+d);break}}m(a),t&&s&&o&&(i(o),setTimeout(()=>{w(t)},100)),P.current=!0}catch(e){console.error("Setup error:",e),p(e.message)}finally{h(!1)}}()},[l,d,e,r]);let E=(0,s.useCallback)(async()=>{let t=f(d,y,c);if(await (0,n.d)(e,y,r,d))N.current.success("Report deleted"),m(e=>{let r=e[d][t].filter(e=>e.report_id!==y),a={...e,[d]:{...e[d],[t]:r}};return 0===r.length&&delete a[d][t],a}),_(null),w(null);else{N.current.error("Failed to delete report");return}},[e,r,y,d,_]),T=(0,s.useMemo)(()=>a.j.jsx("div",{children:a.j.jsx(a.S,{label:!y&&C?"Remove uploaded CSV/Excel files to select a database":"Select Database",rootClassNames:"mb-2",value:d,disabled:null===y&&C,allowClear:!1,allowCreateNewOption:!1,options:[{value:S,label:"Upload new"}].concat(l.map(e=>({value:e,label:e}))),onChange:e=>{i(e),_(null),w(null)}})}),[d,y,l,C,_]),z=(0,s.useMemo)(()=>a.j.jsx(x,{token:r,dbName:d,apiEndpoint:e,onUploadDataFiles:e=>{D(!!(e&&null!=e&&e.length))},onClarified:e=>{e&&(N.current.success(`A new database was created using your uploaded csv/excel files: ${e}`),o(r=>[...r,e]),i(e),w(null),m(r=>({...r,[e]:{Today:[],Yesterday:[],"Past week":[],"Past month":[],Earlier:[]}})))},onReportGenerated:({userQuestion:e,reportId:r,status:t,newDbName:a})=>{m(s=>{var l;return a?{...s,[a]:{Today:[{report_id:r,report_name:e,status:t,date_created:(0,n.o)()}],Yesterday:[],"Past week":[],"Past month":[],Earlier:[]}}:{...s,[d]:{...s[d],Today:[{report_id:r,report_name:e,status:t,date_created:(0,n.o)()},...(null==(l=null==s?void 0:s[d])?void 0:l.Today)||[]]}}}),_(r),w(r)}}),[N,d,_]);return j?a.j.jsxs("div",{className:"w-screen h-screen flex items-center justify-center bg-rose-50 text-rose-500",children:["Error: ",j]}):g?a.j.jsxs("div",{className:"w-screen h-screen flex items-center justify-center bg-gray-50 text-gray-400",children:[a.j.jsx(a.d,{})," ",a.j.jsx("span",{children:"Loading"})]}):a.j.jsxs(a.a.Provider,{value:N.current,children:[a.j.jsx(a.k,{rootClassNames:"absolute left-0 right-0"}),a.j.jsxs("div",{className:"flex flex-row min-w-full min-h-full max-h-full overflow-hidden text-gray-600 bg-white dark:bg-gray-900",children:[a.j.jsx(a.l,{open:!0,beforeTitle:T,location:"left",rootClassNames:"absolute left-0 min-h-full shadow-lg lg:shadow-none lg:sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-r border-gray-100 dark:border-gray-700",title:a.j.jsxs("h2",{className:"font-bold text-gray-800 dark:text-gray-200 mb-3 text-lg flex items-center",children:[a.j.jsx("span",{className:"mr-2",children:"\uD83D\uDCDA"})," History"]}),contentClassNames:"w-72 p-5 rounded-tl-lg relative sm:block min-h-96 max-h-full overflow-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent",children:a.j.jsxs("div",{className:"space-y-4",children:[d!==S?a.j.jsx("div",{className:(0,a.t)("title hover:cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 history-item p-3 text-sm rounded-md transition-colors duration-200 mb-3 flex items-center border border-transparent",y?"text-gray-700 dark:text-gray-300 hover:border-gray-200 dark:hover:border-gray-700":"font-medium bg-blue-50 dark:bg-gray-700 border-blue-200 dark:border-blue-800 shadow-sm text-blue-700 dark:text-blue-300"),onClick:()=>{_(null),w(null)},children:a.j.jsxs("div",{className:"flex flex-row items-center gap-2",children:[a.j.jsx(n.S,{size:18})," ",a.j.jsx("span",{className:"font-medium",children:"New Report"})]})}):a.j.jsx("p",{className:"text-xs",children:"Upload a new CSV/Excel file on the right"}),d!==S&&c[d]&&Object.entries(c[d]).map(([e,r])=>r&&0!==Object.keys(r).length?a.j.jsxs("div",{className:"mb-6",children:[a.j.jsxs("div",{className:"px-2 mb-3 text-xs font-medium tracking-wide text-blue-600 dark:text-blue-400 uppercase flex items-center",children:[a.j.jsx("div",{className:"h-px bg-blue-100 dark:bg-blue-800 flex-grow mr-2"}),e,a.j.jsx("div",{className:"h-px bg-blue-100 dark:bg-blue-800 flex-grow ml-2"})]}),r.map(e=>a.j.jsxs("div",{onClick:()=>{_(e.report_id),w(e.report_id)},className:(0,a.t)("title hover:cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 history-item p-3 text-sm rounded-md transition-colors duration-200 mb-2 border border-transparent",e.report_id===y?"font-medium bg-blue-50 dark:bg-gray-700 border-blue-200 dark:border-blue-800 shadow-sm text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300 hover:border-gray-200 dark:hover:border-gray-700"),children:[a.j.jsx("div",{className:"line-clamp-2 font-medium",children:e.report_name||e.inputs.user_question||"Untitled report"}),a.j.jsxs("div",{className:"flex items-center text-xs mt-1.5 text-gray-500 dark:text-gray-400",children:[a.j.jsx("span",{className:"inline-block w-3 h-3 mr-1.5 rounded-full bg-blue-200 dark:bg-blue-700"}),new Date(e.date_created+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})]})]},e.report_id))]},e):null)]})}),a.j.jsxs("div",{className:"flex flex-col grow p-2 overflow-auto",children:[null===y&&d===S&&a.j.jsx(u,{apiEndpoint:e,token:r,onDbCreated:e=>{m(r=>({...r,[e]:{Today:[],Yesterday:[],"Past week":[],"Past month":[],Earlier:[]}})),o(r=>[...r,e]),i(e)}}),y&&k&&k.status===n.O.DONE?a.j.jsx(v,{reportId:y,apiEndpoint:e,dbName:d,token:r,onDelete:E,onReportParsed:e=>{let r=f(d,y,c);m(t=>{let a=t[d][r];return{...t,[d]:{...t[d],[r]:a.map(r=>r.report_id===y?{...r,reportData:e}:r)}}})}},y):y?a.j.jsx(b,{apiEndpoint:e,token:r,reportId:y,onDelete:E,onStreamClosed:(e,r)=>{if(!d||!y||!c[d]){console.warn("Stream closed but DB or report data missing");return}let t=f(d,y,c);if(!c[d][t]){console.warn("Stream closed but report group missing:",t);return}r?(m(e=>{let r={...e};return r[d]&&r[d][t]&&Array.isArray(r[d][t])&&(r[d][t]=r[d][t].filter(e=>e.report_id!==y)),r}),_(null),w(null)):m(e=>{let r={...e};return r[d]&&r[d][t]&&Array.isArray(r[d][t])&&(r[d][t]=r[d][t].map(e=>e.report_id===y?{...e,status:n.O.DONE}:e)),r})}}):null,null===y&&d!==S&&a.j.jsx("div",{className:"w-full h-full m-auto",children:z})]})]})]})}function v({apiEndpoint:e,reportId:r,dbName:t,token:l,onReportParsed:o=()=>{},onDelete:d=()=>{}}){var i,c,m,x;let[u,g]=(0,s.useState)({}),[h,j]=(0,s.useState)([]),[p,b]=(0,s.useState)([]),[f,y]=(0,s.useState)(null),[v,w]=(0,s.useState)(null),[N,S]=(0,s.useState)(!0),[C,D]=(0,s.useState)(0),[_,P]=(0,s.useState)("table"),[F,E]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{r&&t&&(async(r,t)=>{try{let a;S(!0),(a=await (0,n.j)(e,r,t,l)).parsed.mdx&&y(a.parsed.mdx),a.parsed.tables&&g(a.parsed.tables),a.analyses&&j(a.analyses),a.comments&&b(a.comments),o&&o(a)}catch(e){console.error(e),w(e.message||String(e))}finally{S(!1)}})(r,t)},[r,t]),N)return a.j.jsx("div",{className:"w-full h-full min-h-60 flex flex-col justify-center items-center text-center rounded-md p-2 bg-white dark:bg-gray-800",children:a.j.jsxs("div",{className:"mb-2 text-sm text-gray-400 dark:text-gray-200",children:[a.j.jsx(a.d,{classNames:"w-5 h-5"}),"Loading"]})});if(v)return a.j.jsx("div",{className:"w-full h-full min-h-60 flex flex-col justify-center items-center bg-rose-100 dark:bg-rose-900 text-red text-center rounded-md p-2",children:a.j.jsx("div",{className:"mb-2 text-sm text-rose-500 dark:text-rose-400",children:v})});let T=h.filter(e=>!(null!=e&&e.error)||""===e.error),z=T.length>0&&T[C]||null;return a.j.jsx(n.b.Provider,{value:{apiEndpoint:e,tables:u,multiTables:{},images:{},analyses:h,executiveSummary:{title:"",introduction:"",recommendations:[]},reportId:r,dbName:t,token:l,commentManager:(0,n.c)({apiEndpoint:e,reportId:r,dbName:t,token:l,initialComments:p})},children:a.j.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 relative",children:[a.j.jsx("div",{className:"flex-1 relative oracle-report-ctr",children:a.j.jsx(n.E,{extensions:n.e,content:f,immediatelyRender:!1,editable:!1,slotBefore:a.j.jsx(k,{onDelete:d}),editorProps:{attributes:{class:"max-w-none sm:max-w-2xl lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl oracle-report-tiptap relative prose prose-base dark:prose-invert mx-auto py-2 px-4 sm:px-6 md:px-10 mb-12 md:mb-0 focus:outline-none *:cursor-default"}}})}),T.length>0&&a.j.jsxs("div",{className:"w-full lg:w-[600px] xl:w-[650px] 2xl:w-[800px] lg:sticky lg:top-4 self-start max-h-[calc(100vh-1rem)] flex flex-col border dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-800 mt-4 lg:mt-0",children:[a.j.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700",children:[a.j.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Analysis Results"}),a.j.jsxs("div",{className:"flex items-center space-x-2",children:[a.j.jsx("button",{onClick:()=>P("table"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${"table"===_?"bg-primary-highlight text-gray-200 dark:bg-blue-600 dark:text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Table"}),a.j.jsx("button",{onClick:()=>P("chart"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${"chart"===_?"bg-primary-highlight text-gray-200 dark:bg-blue-600 dark:text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Chart"})]})]}),a.j.jsxs("div",{className:"flex flex-col md:flex-row flex-1 min-h-0 overflow-hidden",children:[a.j.jsx("div",{className:"w-full md:w-[250px] md:border-r dark:border-gray-700 overflow-x-auto md:overflow-x-visible md:overflow-y-auto bg-white dark:bg-gray-800",children:a.j.jsx("div",{className:"flex md:flex-col min-w-max md:min-w-0",children:T.map((e,r)=>{var t;return a.j.jsxs("button",{onClick:()=>D(r),className:`flex-shrink-0 md:flex-shrink text-left p-3 md:w-full border-b dark:border-gray-700 text-sm ${0===r?"":"md:border-t-0"} ${C===r?"bg-gray-100 dark:bg-gray-700 font-medium text-gray-900 dark:text-gray-100 h-auto":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[a.j.jsxs("div",{className:"flex items-center mb-1.5",children:[e.analysis_id&&a.j.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 mr-1.5",children:"SQL"}),"web_search_tool"===e.function_name&&a.j.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 mr-1.5",children:"Web"}),"pdf_citations_tool"===e.function_name&&a.j.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium rounded bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 mr-1.5",children:"PDF"})]}),a.j.jsx("div",{className:`overflow-hidden transition-all duration-300 ${C===r?"max-h-[500px] min-w-[240px] md:min-w-0":"max-h-[4.5rem] min-w-[180px] md:min-w-0 hover:max-h-[500px]"}`,children:a.j.jsx("p",{className:`${C===r?"line-clamp-none":"line-clamp-3 hover:line-clamp-none"}`,children:(null==e?void 0:e.question)||(null==(t=null==e?void 0:e.inputs)?void 0:t.question)})})]},r)})})}),a.j.jsx("div",{className:"w-full overflow-auto p-3 bg-white dark:bg-gray-800",children:z&&z.analysis_id?a.j.jsxs("div",{className:"flex flex-col space-y-4",children:[z.question&&a.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:a.j.jsxs("div",{className:"flex items-start gap-2",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),a.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),a.j.jsxs("div",{children:[a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"SQL Analysis"}),a.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:z.question})]})]})}),a.j.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.j.jsxs("span",{className:"inline-flex items-center gap-1 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 text-xs font-medium px-2.5 py-1 rounded",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[a.j.jsx("path",{d:"M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"}),a.j.jsx("path",{d:"M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"}),a.j.jsx("path",{d:"M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"})]}),(null==z?void 0:z.db_name)||"Database"]}),z.rows&&a.j.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900/30 dark:text-blue-300",children:[z.rows.length," ",1===z.rows.length?"row":"rows"]})]}),a.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 overflow-hidden",children:[a.j.jsxs("div",{className:"flex flex-wrap items-center justify-between p-3 border-b dark:border-gray-600 bg-gray-50 dark:bg-gray-700",children:[a.j.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-0",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 dark:text-indigo-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("polyline",{points:"16 18 22 12 16 6"}),a.j.jsx("polyline",{points:"8 6 2 12 8 18"})]}),a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"table"===_?"SQL Results":"SQL Chart"})]}),(null==z?void 0:z.sql)&&a.j.jsxs("button",{onClick:()=>E(!F),className:"text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded px-2 py-1 transition-colors flex items-center gap-1",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[a.j.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),a.j.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}),F?"Hide SQL":"Show SQL"]})]}),F&&(null==z?void 0:z.sql)&&a.j.jsxs("div",{className:"border-b dark:border-gray-700",children:[a.j.jsxs("div",{className:"flex flex-wrap items-center justify-between px-3 py-2 bg-gray-100 dark:bg-gray-700",children:[a.j.jsxs("div",{className:"flex items-center gap-1.5 mb-2 sm:mb-0",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-500 dark:text-purple-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("path",{d:"M8 9l3 3-3 3"}),a.j.jsx("line",{x1:"13",y1:"15",x2:"16",y2:"15"}),a.j.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})]}),a.j.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:"SQL Query"})]}),a.j.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(z.sql||"")},className:"text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded px-1.5 py-0.5 transition-colors flex items-center gap-1",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:[a.j.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),a.j.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]}),"Copy"]})]}),a.j.jsx("div",{className:"max-h-[150px] sm:max-h-[200px] overflow-auto",children:a.j.jsx(n.C,{code:z.sql||"",language:"sql",editable:!1,className:"text-sm"})})]}),a.j.jsx("div",{className:"p-2 sm:p-3",children:"table"===_?a.j.jsx("div",{className:"w-full overflow-x-auto",children:a.j.jsx(a.g,{columns:z.columns,rows:z.rows,columnHeaderClassNames:"py-2",skipColumns:["index"],rootClassNames:"shadow-sm min-w-[400px]"})}):a.j.jsx(n.h,{children:a.j.jsx("div",{className:"min-h-[250px] sm:min-h-[300px]",children:a.j.jsx(n.i,{rows:z.rows,columns:z.columns,initialQuestion:z.question,initialOptionsExpanded:!1},`chart-${C}`)})})})]})]}):z&&"web_search_tool"===z.function_name?a.j.jsxs("div",{className:"flex flex-col space-y-4",children:[(null==(i=z.inputs)?void 0:i.question)&&a.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:a.j.jsxs("div",{className:"flex items-start gap-2",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),a.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),a.j.jsxs("div",{children:[a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Question"}),a.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:z.inputs.question})]})]})}),(null==(c=z.result)?void 0:c.answer)&&a.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 p-4",children:[a.j.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b dark:border-gray-600",children:[a.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500 dark:text-green-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.j.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Answer from Web Search"})]}),a.j.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:n.m.parse(z.result.answer)}})]}),(null==(m=z.result)?void 0:m.reference_sources)&&Array.isArray(z.result.reference_sources)&&z.result.reference_sources.length>0&&a.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600 p-3 sm:p-4",children:[a.j.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b dark:border-gray-600",children:[a.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 dark:text-indigo-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.j.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})}),a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Reference Sources"})]}),a.j.jsx("ul",{className:"space-y-2",children:z.result.reference_sources.map((e,r)=>a.j.jsxs("li",{className:"flex items-start",children:[a.j.jsx("span",{className:"inline-flex items-center justify-center h-5 w-5 rounded-full bg-indigo-100 dark:bg-indigo-900 text-xs text-indigo-700 dark:text-indigo-300 mr-2 flex-shrink-0",children:r+1}),a.j.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline hover:text-blue-800 dark:hover:text-blue-300 break-all",children:e.source})]},r))})]})]}):z&&"pdf_citations_tool"===z.function_name?a.j.jsxs("div",{className:"flex flex-col space-y-4",children:[(null==(x=z.inputs)?void 0:x.question)&&a.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:a.j.jsxs("div",{className:"flex items-start gap-2",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),a.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),a.j.jsxs("div",{children:[a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Question"}),a.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:z.inputs.question})]})]})}),a.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 p-3 sm:p-4",children:[a.j.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b dark:border-gray-600",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500 dark:text-red-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),a.j.jsx("polyline",{points:"14 2 14 8 20 8"}),a.j.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),a.j.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),a.j.jsx("polyline",{points:"10 9 9 9 8 9"})]}),a.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"PDF Citations"})]}),Array.isArray(z.result)&&z.result.map((e,r)=>a.j.jsxs("div",{className:"mb-4 relative group",children:[a.j.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none py-1",dangerouslySetInnerHTML:{__html:n.m.parse(e.text)}}),e.citations&&Array.isArray(e.citations)&&e.citations.length>0&&a.j.jsxs(a.j.Fragment,{children:[a.j.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 flex flex-wrap items-center",children:[a.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.j.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),a.j.jsx("polyline",{points:"14 2 14 8 20 8"})]}),a.j.jsx("span",{className:"italic mr-1",children:"Source:"}),a.j.jsx("span",{className:"break-all",children:e.citations[0].document_title}),e.citations[0].start_page_number&&a.j.jsxs("span",{className:"ml-1",children:["(Pages"," ",e.citations[0].start_page_number,"-",e.citations[0].end_page_number,")"]})]}),a.j.jsx("div",{className:"absolute left-0 right-0 -bottom-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible md:transition-all md:duration-200 transform translate-y-full z-10",children:a.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600 mt-2 shadow-lg",children:[a.j.jsx("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Cited Text:"}),a.j.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 italic bg-gray-100 dark:bg-gray-800 p-2 rounded",children:['"',e.citations[0].cited_text,'"']})]})}),a.j.jsx("button",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1 block md:hidden",onClick:e=>{var r;let t=null==(r=e.currentTarget.parentElement)?void 0:r.querySelector(".mobile-citation-panel");t&&t.classList.toggle("hidden")},children:"View citation"}),a.j.jsx("div",{className:"mobile-citation-panel hidden mt-2 md:hidden",children:a.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600 shadow-sm",children:[a.j.jsx("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Cited Text:"}),a.j.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 italic bg-gray-100 dark:bg-gray-800 p-2 rounded",children:['"',e.citations[0].cited_text,'"']})]})})]})]},r))]})]}):null})]})]})]})})}function w({onClose:e}){let{commentManager:r}=(0,s.useContext)(n.b),t=(0,s.useSyncExternalStore)((null==r?void 0:r.subscribeToCommentUpdates)||(()=>()=>{}),(null==r?void 0:r.getComments)||(()=>[]));return a.j.jsxs("div",{className:"w-64 h-full flex flex-col",children:[a.j.jsx("div",{className:"h-[3.5rem] invisible"}),a.j.jsxs("div",{className:"flex-1 border-l border-gray-200 dark:border-gray-700 overflow-y-auto bg-white dark:bg-gray-800 shadow-lg",children:[a.j.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.j.jsxs("div",{className:"flex items-center justify-between",children:[a.j.jsxs("div",{className:"flex items-center gap-2",children:[a.j.jsx(c,{className:"w-5 h-5"}),a.j.jsx("h2",{className:"text-lg font-semibold",children:"Comments"}),a.j.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",t.length,")"]})]}),a.j.jsx(a.B,{variant:"secondary",onClick:e,className:"hover:bg-gray-100 dark:hover:bg-gray-700 p-1",children:a.j.jsx(a.X,{className:"w-5 h-5"})})]})}),a.j.jsx("div",{className:"p-4",children:0===t.length?a.j.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No comments yet"}):a.j.jsx("div",{className:"space-y-4",children:t.map(e=>a.j.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700",children:[e.user&&a.j.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e.user}),a.j.jsx("div",{className:(0,a.t)("text-sm text-gray-600 dark:text-gray-300",!e.content&&"text-gray-300"),children:e.content||"Blank comment"})]},e.id))})})]})]})}let k=({onDelete:e=()=>{}})=>{let[r,t]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1),d=(0,s.useContext)(a.a),{apiEndpoint:i,reportId:m,dbName:x,token:u,commentManager:g}=(0,s.useContext)(n.b),h=(0,s.useRef)(null),j=(0,s.useSyncExternalStore)((null==g?void 0:g.subscribeToCommentUpdates)||(()=>()=>{}),(null==g?void 0:g.getComments)||(()=>[])),{editor:p}=(0,n.u)(),b=(0,s.useRef)({});(0,s.useEffect)(()=>{if(j&&j.length>0){let e={};j.forEach(r=>{e[r.id]={id:r.id,commentContent:r.content,user:r.user,htmlSnippet:"",commentRelevantText:r.content}}),b.current=e}},[j]);let f=null==status?void 0:status.startsWith("Revision in progress"),y=()=>{b.current={};let e=null==p?void 0:p.state.doc;e&&(e.nodesBetween(0,e.content.size,(e,r,t)=>{var a;for(let t of e.marks)if("comment"===t.type.name){let s=r+e.textContent.length,l=t.attrs.commentId,n=j.find(e=>e.id===l);if(!n)continue;let o=!1,d=0,i=e,c=r;for(;!o&&d<10&&i;){p.commands.setNodeSelection(c);let e=p.state.selection.$from.parent;"doc"===e.type.name?o=!0:(i=e,c=null==(a=p.state.selection)?void 0:a.from),p.commands.selectParentNode(),d++}b.current[l]?(b.current[l].topParent=i,b.current[l].topParentPos=c,r<b.current[l].startPos&&(b.current[l].startPos=r),s>b.current[l].endPos&&(b.current[l].endPos=s)):b.current[l]={id:l,topParent:i,topParentPos:c,htmlSnippet:"",commentContent:n.content,commentRelevantText:"",startPos:r,endPos:s,user:n.user}}return!0}),Object.values(b.current).forEach(e=>{let r="",t=(r="text"===e.topParent.type.name?"<span class='oracle-report-comment' data-comment-id='temp'>"+e.topParent.textContent+"</span>":"recommendationTitle"===e.topParent.type.name?"## <span class='oracle-report-comment' data-comment-id='temp'>"+e.topParent.textContent+"</span>":'<span class="oracle-report-comment" data-comment-id="temp">'+p.storage.markdown.serializer.serialize(e.topParent)+"</span>").replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"");e.commentRelevantText=t,e.htmlSnippet=r}))},[v,k]=(0,s.useState)(!1);return p?a.j.jsxs("div",{className:"flex flex-col",children:[a.j.jsxs("div",{className:"flex items-center flex-row-reverse justify-between px-4 py-2 border-b dark:border-gray-700",children:[a.j.jsxs("div",{className:"relative",children:[a.j.jsx(a.B,{variant:"secondary",onClick:()=>{y(),o(!l)},className:l?"bg-gray-100 dark:bg-gray-700":"",children:a.j.jsx(c,{className:"w-5 h-5"})}),j.length>0&&a.j.jsx("div",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:j.length})]}),a.j.jsx(a.B,{variant:"danger",onClick:()=>k(!0),children:"Delete"}),a.j.jsx(a.m,{open:v,onOk:()=>{e(m,x),k(!1)},onCancel:()=>k(!1),okText:"Yes",okVariant:"danger",children:"Are you sure?"})]}),f&&a.j.jsxs("div",{className:"w-96 my-4 rounded-full border dark:border-none mx-auto bg-gray-50 dark:bg-gray-600 text-sm text-gray-600 dark:text-gray-300 p-4 flex flex-row shadow-md items-center",children:[a.j.jsx(a.I,{className:"min-w-6 mr-2 text-blue-500 dark:text-blue-400"}),a.j.jsx("p",{children:"This report is currently being revised. This page will refresh when the revision completes."})]}),l&&a.j.jsx("div",{className:"fixed right-0 top-0 bottom-0 z-[100]",children:a.j.jsx(w,{onClose:()=>o(!1)})}),status&&a.j.jsx("div",{className:`fixed bottom-6 ${l?"right-72":"right-6"} z-[110] transition-all duration-200`,children:a.j.jsx(a.B,{variant:"primary",onClick:()=>{y(),t(!0)},disabled:!status||f,className:"shadow-lg hover:shadow-xl transition-shadow",children:"Submit for revision"})}),a.j.jsx(a.m,{rootClassNames:"w-full z-10",open:r,onCancel:()=>t(!1),onOk:()=>{var e;try{(0,n.k)(i,m,x,u,null==(e=h.current)?void 0:e.value,j.map(e=>({relevant_text:e.content,comment_text:e.content}))).then(e=>{t(!1)}).catch(e=>{console.error(e),d.error(e.message)})}catch(e){d.error(e.message)}},title:"Revise report",okText:"Submit",className:"dark:bg-gray-800 dark:text-gray-200",contentClassNames:"overflow-auto",children:a.j.jsxs("div",{className:"flex flex-row flex-wrap gap-4",children:[Object.values(b.current).map((e,r)=>a.j.jsxs("div",{className:"revise-modal-comment-container w-full",children:[a.j.jsx("div",{className:"revise-modal-header",children:"Highlighted text"}),a.j.jsx(n.E,{content:e.htmlSnippet,extensions:n.r,immediatelyRender:!1,editable:!1,editorProps:{attributes:{class:"revise-modal-highlight prose prose-sm dark:prose-invert focus:outline-none *:cursor-default"}}}),a.j.jsx("div",{className:"revise-modal-header",children:"Your comment"}),a.j.jsx("textarea",{className:"text-sm revise-modal-comment-text w-full h-full focus:ring-0 border-none outline-none",defaultValue:e.commentContent,placeholder:"Type your comment here",onChange:r=>{b.current[e.id].commentContent=r.target.value,null==g||g.updateComments(p,Object.values(b.current).map(e=>({id:e.id,content:e.commentContent,user:e.user})))}})]},e.id)),a.j.jsxs("div",{className:"w-full revise-modal-comment-container overflow-hidden",children:[a.j.jsx("div",{className:"revise-modal-header",children:"General comments"}),a.j.jsx(a.T,{autoResize:!0,placeholder:"Add general comments here",rootClassNames:"border-none",textAreaClassNames:"rounded-none ring-0",ref:h,textAreaHtmlProps:{resize:"none"}})]})]})})]}):null}}}]);