(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{2149:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/query-data",function(){return a(8115)}])},2427:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(5105),s=a(761),n=a.n(s);let o=()=>(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,r.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},2678:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(5105),s=a(8101),n=a(5922),o=a(7280),i=a(5337),l=a(4799);let d=e=>{let{id:t,userType:a,children:d,rootClassNames:c="",contentClassNames:h="max-h-full h-full",containerClassNames:u="flex flex-col md:min-h-screen relative container mx-auto"}=e,[m,f]=(0,s.useState)([]),g=(0,n.useRouter)(),y=e=>{g.push(e)},_=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),y("/log-in")},p=(0,i.usePathname)();return(0,s.useEffect)(()=>{f(("admin"==a?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:_}]:a?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:_}]:[]).map(e=>(e.current=e.href==p,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==p,e))),e)))},[a]),(0,r.jsxs)("div",{className:(0,l.QP)(u,c),children:[m.length?(0,r.jsx)(o.jq,{rootClassNames:(0,l.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:m.map(e=>({...e,classNames:(0,l.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)("div",{className:h,children:d})]})}},8115:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(5105),s=a(8101),n=a(5922),o=a(2427),i=a(2678),l=a(7280),d=a(5405),c=a(6485);function h(e){let{token:t,dbs:a,hideSqlTab:n=!1,hidePreviewTabs:o=!1,hiddenCharts:i=[],hideRawAnalysis:h=!1}=e,[u,m]=(0,s.useState)(null),[f,g]=(0,s.useState)(!0),[y,_]=(0,s.useState)(null);(0,s.useEffect)(()=>{fetch("".concat(c.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/get_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})}).then(e=>e.ok?e.json():{error:"Could not fetch user history"}).then(e=>{if(e.error){_(e.error);return}g(!1),m(e.history||{})})},[]);let p=(0,s.useCallback)((e,a)=>{if(e&&a)try{fetch("".concat(c.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/update_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,history:a,db_name:e})}).then(e=>e.json()).then(e=>{if(e.error)throw Error(e.error)})}catch(e){console.error(e)}},[]);return f||y||!u?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:y?"".concat(y):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.c5,{})," Loading"]})}):(0,r.jsx)(d.sd,{initialDbList:a,hiddenCharts:["boxplot","histogram"],token:t,searchBarDraggable:!1,hidePreviewTabs:!1,apiEndpoint:c.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"",initialTrees:u,hideRawAnalysis:h,hideSqlTab:n,onTreeChange:(e,t)=>{p(e,t)}})}var u=a(6485);let m=()=>{let e=(0,n.useRouter)(),[t,a]=(0,s.useState)(""),[d,c]=(0,s.useState)(""),[m,f]=(0,s.useState)(""),[g,y]=(0,s.useState)([]),[_,p]=(0,s.useState)(!1),[x,N]=(0,s.useState)(!1),[b,k]=(0,s.useState)({}),j=async e=>{p(!0);let t=await fetch((u.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!t.ok)throw p(!1),Error("Failed to get api key names - are you sure your network is working?");let a=await t.json();if(y(a.db_names),!(t=await fetch((u.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_non_admin_config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})})).ok)throw p(!1),Error("Failed to get non admin config - are you sure your network is working?");k(a=await t.json()),p(!1)};console.log(b),(0,s.useEffect)(()=>{let t=localStorage.getItem("defogToken"),r=localStorage.getItem("defogUserType");if(c(localStorage.getItem("defogUser")),f(r),a(t),!t){N(!0),setTimeout(()=>{let t=window.location.pathname+window.location.search;e.push({pathname:"/log-in",query:{message:"You are not logged in. Please log in to access query data.",returnUrl:t}})},1500);return}j(t)},[e]);let w="admin"===m;return(0,r.jsxs)("div",{className:"max-h-screen h-screen",children:[(0,r.jsx)(o.A,{}),(0,r.jsx)(i.A,{id:"query-data",userType:m,containerClassNames:"max-h-screen h-screen flex flex-col",contentClassNames:"h-full max-h-full",children:x?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center text-gray-400 text-sm",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Not Logged In"}),(0,r.jsx)("p",{className:"mb-4",children:"You are not logged in. Redirecting to login page..."}),(0,r.jsx)(l.c5,{})]}):t?_?(0,r.jsxs)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:["Loading DBs ",(0,r.jsx)(l.c5,{classNames:"ml-4"})]}):(0,r.jsx)(h,{token:t,devMode:!1,isAdmin:w,hideSqlTab:!w&&b.hide_sql_tab_for_non_admin,hidePreviewTabs:!w&&b.hide_preview_tabs_for_non_admin,hiddenCharts:w?[]:b.hidden_charts_for_non_admin||[],hideRawAnalysis:!w&&b.hide_raw_analysis_for_non_admin,dbs:(g.length>0?g:[]).map(e=>({name:e,keyName:e,predefinedQuestions:"Manufacturing"===e?["What is the average rejection rate by lot?","Is there a difference in the plasticity of components that are rejected vs accepted?"]:"Sales"===e?["Who are our top 5 customers by revenue?","What was the month on month change in revenue?"]:"Slack"===e?["What is the count of number of queries by db type in the last 30 days, except for queries made by jp@defog.ai?","Which users have the most queries?"]:["Show me any 5 rows from the first table"]}))}):(0,r.jsx)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:"No token found. Please log out and log back in."})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[848,894,645,405,636,593,792],()=>t(2149)),_N_E=e.O()}]);