(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[594],{1185:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return s(1181)}])},2427:(e,r,s)=>{"use strict";s.d(r,{A:()=>d});var a=s(5105),t=s(761),o=s.n(t);let d=()=>(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},2678:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var a=s(5105),t=s(8101),o=s(5922),d=s(7280),n=s(5337),l=s(4799);let i=e=>{let{id:r,userType:s,children:i,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[g,y]=(0,t.useState)([]),x=(0,o.useRouter)(),b=e=>{x.push(e)},h=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),b("/log-in")},p=(0,n.usePathname)();return(0,t.useEffect)(()=>{y(("admin"==s?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:h}]:s?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:h}]:[]).map(e=>(e.current=e.href==p,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==p,e))),e)))},[s]),(0,a.jsxs)("div",{className:(0,l.QP)(m,c),children:[g.length?(0,a.jsx)(d.jq,{rootClassNames:(0,l.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:g.map(e=>({...e,classNames:(0,l.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:u,children:i})]})}},1181:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>k});var a=s(5105),t=s(8101),o=s(5922),d=s(2427),n=s(2678),l=s(9157),i=s(1635),c=s(3106),u=s(576),m=s.n(u),g=s(7280);let y=e=>{let{loading:r,getUserDets:s}=e,[o,d]=(0,t.useState)([{username:"",password:"",userType:""}]),[n,u]=(0,t.useState)("username,password,user_type\n"),[y,x]=(0,t.useState)(""),[b,h]=(0,t.useState)(!1),p=(0,t.useContext)(g.oS),f=t.useRef(null);(0,t.useEffect)(()=>{let e=o.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");u("username,password,user_type\n".concat(e))},[o]);let w=e=>(m().parse(e,{error:e=>{p.error("There was an error parsing the CSV file.")},complete:e=>{d(e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}))),h(!0),x(""),p.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),k=async e=>{e.preventDefault();try{let e=localStorage.getItem("defogToken"),r="username,password,user_type"!==n.trim()?{users_csv:n,token:e}:{gsheets_url:y,token:e},a=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let t=await a.json();if("success"===t.status)p.success("Users added successfully! Refreshing the user data..."),d([{username:"",password:"",userType:""}]);else throw Error(t.message||"There was an error adding the users.");await s()}catch(e){console.error("Error:",e),p.error(e.message||"There was an error adding the users. Please try again.")}finally{h(!1),u("username,password,user_type\n")}};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-gray-800",children:[(0,a.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8 dark:text-gray-100",children:[(0,a.jsx)(i.A,{size:24,className:"mr-2 dark:text-blue-400"}),"Add Users via File"]}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4 dark:text-gray-200",children:"Upload CSV File"}),(0,a.jsxs)("div",{className:"mb-4",children:[!b&&(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Expected columns in the file: username,password,user_type,allowed_dbs. For users that must login via SSO, please set the password column to blank."}),(0,a.jsx)("input",{type:"file",ref:f,accept:".csv",onChange:e=>{let r=e.target.files[0];r&&w(r)},className:"hidden",disabled:b||r}),(0,a.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.click()},disabled:b||r,className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(c.A,{size:20,className:"mr-2"}),b?"Uploaded":"Upload CSV"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4 dark:text-gray-200",children:"Or a paste publicly accessible Google Sheets URL"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Google Sheets URL"}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>x(e.target.value),className:"mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:r})]})]}),b&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Generated CSV String"}),(0,a.jsx)("textarea",{value:n,readOnly:!0,rows:4,className:"mt-1 block w-full font-mono border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-100 dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsx)("button",{type:"submit",disabled:"username,password,user_type"===n.trim()&&!y||r,className:"w-1/3 mx-auto block px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Users"})]})]})};var x=s(881),b=s(6485);let h=e=>{let{loading:r,getUserDets:s}=e,[o,d]=(0,t.useState)([{username:"",password:"",userType:"",userDb:[]}]),[n,i]=(0,t.useState)("username,password,user_type,allowed_dbs\n"),[c,u]=(0,t.useState)([]),m=(0,t.useContext)(g.oS),y=async()=>{let e=localStorage.getItem("defogToken"),r=await fetch((b.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!r.ok)throw Error("Failed to get api key names - are you sure your network is working?");u((await r.json()).db_names)};(0,t.useEffect)(()=>{y();let e=o.filter(e=>e.username&&e.userType).map(e=>"".concat(e.username,",").concat(e.password||"",",").concat(e.userType,",").concat(e.userDb.join("|"))).join("\n");i("username,password,user_type,allowed_dbs\n".concat(e))},[o]);let h=(e,r,s)=>{let a=[...o];a[e][r]=s,d(a)},p=async e=>{e.preventDefault();let r=localStorage.getItem("defogToken"),a=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:n,token:r})});"success"===(await a.json()).status?(m.success("Users added successfully! Refreshing the user data..."),d([{username:"",password:"",userType:"",userDb:[]}])):m.error("There was an error adding the users. Please try again."),await s()};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-gray-800",children:[(0,a.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8 dark:text-gray-100",children:[(0,a.jsx)(x.A,{size:24,className:"mr-2 dark:text-blue-400"}),"Add Users Manually"]}),(0,a.jsxs)("form",{onSubmit:p,className:"w-full space-y-6",children:[o.map((e,s)=>(0,a.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Username",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.username,onChange:e=>h(s,"username",e.target.value),required:!0,disabled:r})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password (leave blank for SSO users)"}),(0,a.jsx)("input",{type:"password",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.password,onChange:e=>h(s,"password",e.target.value),disabled:r})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["User Type",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.userType,onChange:e=>h(s,"userType",e.target.value),required:!0,disabled:r,children:[(0,a.jsx)("option",{value:"",children:"Select type"}),(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"general",children:"General"})]})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Allowed DBs (leave blank for all DBs)"}),(0,a.jsx)("select",{multiple:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.userDb,onChange:e=>h(s,"userDb",Array.from(e.target.selectedOptions,e=>e.value)),disabled:r,children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]},s)),(0,a.jsx)("button",{type:"button",onClick:()=>d([...o,{username:"",password:"",userType:"",userDb:[]}]),className:"w-full py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-gray-400",disabled:r,children:"Add Another User"}),"username,password,user_type,allowed_dbs"!==n.trim()&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Generated CSV String"}),(0,a.jsx)("textarea",{value:n,readOnly:!0,rows:2,className:"w-full font-mono border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-100 dark:bg-gray-700 dark:text-gray-200 p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsx)("button",{type:"submit",className:"w-1/3 mx-auto block mt-20 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r||"username,password,user_type,allowed_dbs"===n.trim(),children:"Add Users"})]})]})};var p=s(5814);let f=e=>{let{userDets:r,getUserDets:s,loading:o,setLoading:d}=e,n=(0,t.useContext)(g.oS),i=async e=>{d(!0);let r=localStorage.getItem("defogToken"),a=await fetch((0,l.A)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:r}),headers:{"Content-Type":"application/json"}});"success"===(await a.json()).status?n.success("User deleted successfully! Refreshing the user data..."):n.error("There was an error deleting the user. Please try again."),await s(),d(!1)},c=[{title:"User ID",dataIndex:"username",key:"username",width:"30%"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"30%"},{title:"Allowed DBs",dataIndex:"allowed_dbs",key:"allowed_dbs",width:"30%"},{title:"Action",dataIndex:"__actions",key:"delete_user",width:"10%",render:(e,r)=>(0,a.jsx)(g.$n,{variant:"normal",icon:(0,a.jsx)(p.A,{}),onClick:()=>i(r.username),className:"hover:bg-gray-100 dark:hover:bg-gray-700"})}];return(0,a.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,a.jsxs)("div",{className:"relative mt-10",children:[o&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/70 dark:bg-gray-900/70 backdrop-blur-[1px] z-10",children:[(0,a.jsx)(g.c5,{classNames:"text-blue-500 h-6 w-6"}),(0,a.jsx)("span",{className:"mt-2 text-sm font-medium text-gray-600 dark:text-gray-300",children:"Getting Latest Users Data"})]}),(0,a.jsx)(g.XI,{columns:c,rows:r.map((e,r)=>({...e,key:"row-".concat(r),__origIndex:r})),rowCellRender:e=>{let{cellValue:r,row:s,dataIndex:t,column:o}=e;return"function"==typeof o.render?(0,a.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700",children:o.render(r,s)},s.key+"-"+t):(0,a.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700 whitespace-nowrap",children:r},s.key+"-"+t)},headerCellRender:e=>{let{column:r}=e;return(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",style:{width:r.width},children:r.title},r.key)},rootClassNames:"border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-dark-bg-secondary overflow-hidden",pagination:{defaultPageSize:10,showSizeChanger:!1},paginationPosition:"bottom",showSearch:!1})]})})};var w=s(2047);let k=()=>{let[e,r]=(0,t.useState)(!1),[s,i]=(0,t.useState)([]),c=(0,t.useContext)(g.oS),u=(0,o.useRouter)(),m=async()=>{r(!0);let e=localStorage.getItem("defogToken");if(!e){r(!1),c.error("It seems like there was no token found in your session. Please try to log in again.");return}let s=await fetch((0,l.A)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}}),a=await s.json();a.users?i(a.users):c.error("There was an error fetching the user data. Please try again."),r(!1)};return(0,t.useEffect)(()=>{let e=localStorage.getItem("defogUser"),r=localStorage.getItem("defogToken"),s=localStorage.getItem("defogUserType");if(!e||!r||!s){u.push("/log-in");return}r?m():u.push("/log-in")},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{}),(0,a.jsxs)(n.A,{id:"manage-users",userType:"admin",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,a.jsxs)("h1",{children:[(0,a.jsx)(w.A,{size:48,className:"text-blue-500 dark:text-blue-400"})," "]}),(0,a.jsx)("h1",{className:"text-3xl mt-4 dark:text-gray-100",children:"Manage Users"})]}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,a.jsx)(f,{userDets:s,getUserDets:m,loading:e,setLoading:r})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,a.jsx)(y,{loading:e,getUserDets:m})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,a.jsx)(h,{loading:e,getUserDets:m})})]})]})}},9157:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var a=s(6485);let t=(e,r)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==r?"ws"===e?"".concat((a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(r):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(r):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var r=r=>e(e.s=r);e.O(0,[894,798,636,593,792],()=>r(1185)),_N_E=e.O()}]);